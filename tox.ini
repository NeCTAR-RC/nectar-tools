[tox]
envlist = flake8, py3

[testenv]
setenv =
    PYTHONPATH = {toxinidir}:{toxinidir}/nectar_tools
commands =
    /bin/bash pretty_tox.sh '{posargs}'

deps =
    -r{toxinidir}/requirements.txt
    -r{toxinidir}/test-requirements.txt

[testenv:flake8]
basepython = python2.7
deps =
    flake8
    git+https://github.com/NeCTAR-RC/git-lint-diff.git#egg=git-lint-diff
commands = git-lint-diff --linter flake8

[flake8]
builtins = _
exclude = .venv,.git,.tox,dist,docs,*lib/python*,*egg,build

[pytest]
norecursedirs = .venv .git .tox dist doc *lib/python* *egg build

[testenv:py3]
basepython = python3

[testenv:cover]
# Also do not run test_coverage_ext tests while gathering coverage as those
# tests conflict with coverage.
commands =
  coverage erase
  /usr/bin/find . -type f -name "*.pyc" -delete
  python setup.py testr --coverage --testr-args='{posargs}'
  coverage report 